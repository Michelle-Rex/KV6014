PRAGMA foreign_keys = ON;

-- HANDLE LOGINS
CREATE TABLE Role (
	RoleID INTEGER PRIMARY KEY AUTOINCREMENT,
	RoleName TEXT NOT NULL CHECK (RoleName IN ('carer', 'family_member'))
);
CREATE TABLE User (
	UserID INTEGER PRIMARY KEY AUTOINCREMENT,
	RoleID INTEGER NOT NULL,
	FirstName TEXT NOT NULL,
	LastName TEXT NOT NULL,
	Email TEXT NOT NULL UNIQUE,
	PasswordHash TEXT NOT NULL,
	FOREIGN KEY (RoleID) REFERENCES Role(RoleID)
);

-- USER DATA
CREATE TABLE Patient (
	PatientID INTEGER PRIMARY KEY AUTOINCREMENT,
	CarerID INTEGER,
	FirstName TEXT NOT NULL,
	LastName TEXT NOT NULL,
	ResidenceType TEXT CHECK (ResidenceType IN ('Home', 'Care Home', 'Hospital', 'Other')) DEFAULT 'Home',
	Address TEXT,
	DementiaType TEXT,
	DementiaStage TEXT CHECK (DementiaStage IN ('Early', 'Mid', 'Late')) DEFAULT 'Early',
	FOREIGN KEY (CarerID) REFERENCES User(UserID)
);


CREATE TABLE Family_Member (
	FamilyMemberID INTEGER PRIMARY KEY AUTOINCREMENT,
	UserID INTEGER NOT NULL,
	PatientID INTEGER NOT NULL,
	PhoneNumber TEXT,
	ContentAccessLvl TEXT CHECK (ContentAccessLvl IN ('basic', 'detailed', 'full')) DEFAULT 'basic',
	FOREIGN KEY (UserID) REFERENCES User(UserID),
	FOREIGN KEY (PatientID) REFERENCES Patient(PatientID)
);


CREATE TABLE Log_Item (
	LogID INTEGER PRIMARY KEY AUTOINCREMENT,
	PatientID INTEGER NOT NULL,
	AuthorID INTEGER NOT NULL,
	Content TEXT NOT NULL,
	ContentLvl TEXT CHECK (ContentLvl IN ('general', 'medical', 'private')) DEFAULT 'general',
	DateTime DATETIME DEFAULT CURRENT_TIMESTAMP,
	FOREIGN KEY (PatientID) REFERENCES Patient(PatientID),
	FOREIGN KEY (AuthorID) REFERENCES User(UserID)
);
